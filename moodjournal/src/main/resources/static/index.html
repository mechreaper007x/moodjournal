<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood Journal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/4.4.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.0/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-tab {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            border-radius: 25px;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 120px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            transform: none;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
        }

        .mood-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .mood-option {
            padding: 10px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .mood-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .mood-option.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .mood-option.ai-suggested {
            border-color: #28a745;
            background: #f0fff4;
        }

        .mood-option.ai-suggested.selected {
            background: #28a745;
            color: white;
        }

        .ai-suggestion-box {
            margin-top: 15px;
            padding: 20px;
            background: linear-gradient(135deg, #f0f8ff, #e6f3ff);
            border-radius: 15px;
            border: 2px solid #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .ai-suggestion-box h4 {
            margin: 0 0 10px 0;
            color: #667eea;
            font-size: 1.1rem;
        }

        .ai-suggestion-box p {
            margin: 0 0 10px 0;
            line-height: 1.6;
        }

        .ai-suggestion-box .confidence {
            font-size: 0.9rem;
            color: #666;
        }

        .journal-entry {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid;
        }

        .journal-entry.HAPPY { border-left-color: #28a745; }
        .journal-entry.SAD { border-left-color: #6c757d; }
        .journal-entry.ANXIOUS { border-left-color: #ffc107; }
        .journal-entry.ANGRY { border-left-color: #dc3545; }
        .journal-entry.CHILL { border-left-color: #17a2b8; }
        .journal-entry.CALM { border-left-color: #20c997; }
        .journal-entry.NEUTRAL { border-left-color: #6f42c1; }

        .mood-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            color: white;
            margin-left: 10px;
        }

        .mood-badge.HAPPY { background: #28a745; }
        .mood-badge.SAD { background: #6c757d; }
        .mood-badge.ANXIOUS { background: #ffc107; color: #333; }
        .mood-badge.ANGRY { background: #dc3545; }
        .mood-badge.CHILL { background: #17a2b8; }
        .mood-badge.CALM { background: #20c997; }
        .mood-badge.NEUTRAL { background: #6f42c1; }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .entry-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .entry-date {
            color: #666;
            font-size: 0.9rem;
        }

        .entry-content {
            line-height: 1.6;
            color: #555;
            margin-bottom: 15px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            color: #333;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 1rem;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #333;
        }

        .filter-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        .entry-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .mood-selector {
                justify-content: center;
            }
            
            .filter-controls {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // API Configuration
        const API_BASE_URL = 'http://localhost:9090';

        const api = axios.create({
            baseURL: API_BASE_URL,
            timeout: 10000,
            headers: {
                'Content-Type': 'application/json',
            }
        });

        // Add request interceptor for debugging
        api.interceptors.request.use(request => {
            console.log('Making API request:', request.method.toUpperCase(), request.url, request.data);
            return request;
        });

        // Add response interceptor for error handling
        api.interceptors.response.use(
            response => response,
            error => {
                console.error('API Error:', error.response?.data || error.message);
                return Promise.reject(error);
            }
        );

        // API Functions
        const journalAPI = {
            createEntry: (entry) => api.post('/api/journal-entries', entry),
            getAllEntries: () => api.get('/api/journal-entries'),
            getMyEntries: (userId) => api.get(`/api/journal-entries/user/${userId}`),
            getCommunityEntries: (mood) => api.get(`/api/journal-entries/public${mood ? `?mood=${mood}` : ''}`),
            updateEntry: (id, entry) => api.put(`/api/journal-entries/${id}`, entry),
            deleteEntry: (id) => api.delete(`/api/journal-entries/${id}`),
        };

        // AI API Functions - THIS WAS MISSING!
        const aiAPI = {
            analyzeMood: (content) => api.post('/api/ai/suggest-mood', { content: content })
        };

        const userAPI = {
            register: (user) => api.post('/api/auth/register', user),
        };

        // Mood options
        const MOOD_OPTIONS = ['HAPPY', 'SAD', 'ANXIOUS', 'ANGRY', 'CHILL', 'CALM', 'NEUTRAL'];
        const VISIBILITY_OPTIONS = ['PRIVATE', 'PUBLIC_ANON'];

        // Main App Component
        function MoodJournalApp() {
            const [activeTab, setActiveTab] = useState('create');
            const [entries, setEntries] = useState([]);
            const [myEntries, setMyEntries] = useState([]);
            const [communityEntries, setCommunityEntries] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');
            const [currentUser, setCurrentUser] = useState(null);

            // Simulate user login for demo purposes
            useEffect(() => {
                // In a real app, you'd handle authentication properly
                setCurrentUser({ id: 1, username: 'demo_user' });
            }, []);

            const clearMessages = () => {
                setError('');
                setSuccess('');
            };

            const showError = (message) => {
                setError(message);
                setTimeout(clearMessages, 5000);
            };

            const showSuccess = (message) => {
                setSuccess(message);
                setTimeout(clearMessages, 3000);
            };

            const fetchAllEntries = async () => {
                try {
                    setLoading(true);
                    const response = await journalAPI.getAllEntries();
                    setEntries(response.data);
                } catch (err) {
                    showError('Failed to fetch entries');
                } finally {
                    setLoading(false);
                }
            };

            const fetchMyEntries = async () => {
                if (!currentUser) {
                    console.log('No current user, skipping fetchMyEntries');
                    return;
                }
                try {
                    setLoading(true);
                    console.log('Fetching entries for user:', currentUser.id);
                    const response = await journalAPI.getMyEntries(currentUser.id);
                    console.log('API Response for my entries:', response.data);
                    setMyEntries(response.data);
                } catch (err) {
                    console.error('Error fetching my entries:', err);
                    showError('Failed to fetch your entries: ' + (err.response?.data?.error || err.message));
                } finally {
                    setLoading(false);
                }
            };

            const fetchCommunityEntries = async (moodFilter = '') => {
                try {
                    setLoading(true);
                    const response = await journalAPI.getCommunityEntries(moodFilter);
                    setCommunityEntries(response.data);
                } catch (err) {
                    showError('Failed to fetch community entries');
                } finally {
                    setLoading(false);
                }
            };

            const handleTabChange = (tab) => {
                setActiveTab(tab);
                clearMessages();
                
                switch (tab) {
                    case 'my-entries':
                        fetchMyEntries();
                        break;
                    case 'community':
                        fetchCommunityEntries();
                        break;
                    case 'dashboard':
                        fetchMyEntries();
                        break;
                }
            };

            return (
                <div className="container">
                    <div className="header">
                        <h1>🌈 Mood Journal</h1>
                        <p>Track your emotions, visualize your mental wellness journey</p>
                    </div>

                    {error && <div className="error">{error}</div>}
                    {success && <div className="success">{success}</div>}

                    <div className="nav-tabs">
                        <button 
                            className={`nav-tab ${activeTab === 'create' ? 'active' : ''}`}
                            onClick={() => handleTabChange('create')}
                        >
                            ✍️ Write Entry
                        </button>
                        <button 
                            className={`nav-tab ${activeTab === 'my-entries' ? 'active' : ''}`}
                            onClick={() => handleTabChange('my-entries')}
                        >
                            📖 My Entries
                        </button>
                        <button 
                            className={`nav-tab ${activeTab === 'community' ? 'active' : ''}`}
                            onClick={() => handleTabChange('community')}
                        >
                            🌍 Community
                        </button>
                        <button 
                            className={`nav-tab ${activeTab === 'dashboard' ? 'active' : ''}`}
                            onClick={() => handleTabChange('dashboard')}
                        >
                            📊 Dashboard
                        </button>
                    </div>

                    {activeTab === 'create' && <CreateEntry onSuccess={showSuccess} onError={showError} currentUser={currentUser} />}
                    {activeTab === 'my-entries' && <MyEntries entries={myEntries} loading={loading} onRefresh={fetchMyEntries} onSuccess={showSuccess} onError={showError} />}
                    {activeTab === 'community' && <CommunityEntries entries={communityEntries} loading={loading} onMoodFilter={fetchCommunityEntries} />}
                    {activeTab === 'dashboard' && <Dashboard entries={myEntries} loading={loading} />}
                </div>
            );
        }

        // Create Entry Component
        function CreateEntry({ onSuccess, onError, currentUser }) {
            const [formData, setFormData] = useState({
                title: '',
                content: '',
                mood: '',
                visibility: 'PRIVATE'
            });
            const [submitting, setSubmitting] = useState(false);
            const [aiSuggestion, setAiSuggestion] = useState(null);
            const [analyzingMood, setAnalyzingMood] = useState(false);

            const handleInputChange = (e) => {
                setFormData({ ...formData, [e.target.name]: e.target.value });
                
                // Clear AI suggestion when content changes significantly
                if (e.target.name === 'content' && aiSuggestion) {
                    setAiSuggestion(null);
                }
            };

            const handleMoodSelect = (mood) => {
                setFormData({ ...formData, mood });
            };

            const analyzeMoodAI = async () => {
                if (!formData.content.trim()) {
                    onError('Please write some content first to analyze mood');
                    return;
                }

                if (formData.content.trim().length < 10) {
                    onError('Please write at least 10 characters for accurate mood analysis');
                    return;
                }

                try {
                    setAnalyzingMood(true);
                    console.log('Analyzing mood for content:', formData.content);
                    
                    const response = await aiAPI.analyzeMood(formData.content);
                    console.log('AI Response:', response.data);
                    
                    setAiSuggestion(response.data);
                    
                    // Auto-select the suggested mood
                    setFormData({ ...formData, mood: response.data.suggestedMood });
                    
                    onSuccess('AI analysis complete! 🤖');
                } catch (err) {
                    console.error('AI Analysis Error:', err);
                    onError('Failed to analyze mood. Please select manually. Error: ' + (err.response?.data?.message || err.message));
                } finally {
                    setAnalyzingMood(false);
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!formData.title || !formData.content || !formData.mood) {
                    onError('Please fill in all required fields');
                    return;
                }

                try {
                    setSubmitting(true);
                    await journalAPI.createEntry({
                        ...formData,
                        userId: currentUser?.id
                    });
                    
                    setFormData({ title: '', content: '', mood: '', visibility: 'PRIVATE' });
                    setAiSuggestion(null);
                    onSuccess('Journal entry created successfully! 🎉');
                } catch (err) {
                    onError('Failed to create entry. Please try again.');
                } finally {
                    setSubmitting(false);
                }
            };

            return (
                <div className="card">
                    <h2>✨ Create New Journal Entry</h2>
                    <form onSubmit={handleSubmit}>
                        <div className="form-group">
                            <label>Title *</label>
                            <input
                                type="text"
                                name="title"
                                className="form-control"
                                value={formData.title}
                                onChange={handleInputChange}
                                placeholder="What's on your mind today?"
                                maxLength="100"
                                required
                            />
                        </div>

                        <div className="form-group">
                            <label>Your thoughts * <small>(Write at least 10 characters for AI analysis)</small></label>
                            <textarea
                                name="content"
                                className="form-control"
                                value={formData.content}
                                onChange={handleInputChange}
                                placeholder="Write about your day, your feelings, or anything that comes to mind..."
                                required
                            />
                            <div style={{ marginTop: '10px' }}>
                                <button 
                                    type="button" 
                                    className="btn btn-secondary" 
                                    onClick={analyzeMoodAI}
                                    disabled={analyzingMood || formData.content.trim().length < 10}
                                >
                                    {analyzingMood ? '🤔 Analyzing...' : '🤖 AI Mood Analysis'}
                                </button>
                            </div>
                            
                            {aiSuggestion && (
                                <div className="ai-suggestion-box">
                                    <h4>🤖 AI Analysis Results</h4>
                                    <p><strong>Analysis:</strong> {aiSuggestion.message}</p>
                                    <p><strong>Suggested Mood:</strong> 
                                        <span className={`mood-badge ${aiSuggestion.suggestedMood}`}>
                                            {aiSuggestion.suggestedMood}
                                        </span>
                                    </p>
                                    <p className="confidence">
                                        <strong>Confidence:</strong> {aiSuggestion.confidence}%
                                    </p>
                                </div>
                            )}
                        </div>

                        <div className="form-group">
                            <label>How are you feeling? * 
                                {aiSuggestion && (
                                    <span style={{color: '#28a745', fontWeight: 'normal'}}>
                                        {' '}(AI suggested: {aiSuggestion.suggestedMood})
                                    </span>
                                )}
                            </label>
                            <div className="mood-selector">
                                {MOOD_OPTIONS.map(mood => (
                                    <div
                                        key={mood}
                                        className={`mood-option ${formData.mood === mood ? 'selected' : ''} ${
                                            aiSuggestion && aiSuggestion.suggestedMood === mood ? 'ai-suggested' : ''
                                        }`}
                                        onClick={() => handleMoodSelect(mood)}
                                    >
                                        {mood} {aiSuggestion && aiSuggestion.suggestedMood === mood && '🤖'}
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="form-group">
                            <label>Visibility</label>
                            <select
                                name="visibility"
                                className="form-control"
                                value={formData.visibility}
                                onChange={handleInputChange}
                            >
                                <option value="PRIVATE">Private (only you can see)</option>
                                <option value="PUBLIC_ANON">Share with community (anonymous)</option>
                            </select>
                        </div>

                        <button type="submit" className="btn" disabled={submitting}>
                            {submitting ? '✨ Creating...' : '📝 Save Entry'}
                        </button>
                    </form>
                </div>
            );
        }

        // My Entries Component
        function MyEntries({ entries, loading, onRefresh, onSuccess, onError }) {
            const [editingEntry, setEditingEntry] = useState(null);

            useEffect(() => {
                onRefresh();
            }, []);

            const handleDelete = async (id) => {
                if (!window.confirm('Are you sure you want to delete this entry?')) return;
                
                try {
                    await journalAPI.deleteEntry(id);
                    onSuccess('Entry deleted successfully');
                    onRefresh();
                } catch (err) {
                    onError('Failed to delete entry');
                }
            };

            const handleEdit = (entry) => {
                setEditingEntry({ ...entry });
            };

            const handleSaveEdit = async () => {
                try {
                    await journalAPI.updateEntry(editingEntry.id, {
                        title: editingEntry.title,
                        content: editingEntry.content,
                        mood: editingEntry.mood,
                        visibility: editingEntry.visibility
                    });
                    onSuccess('Entry updated successfully');
                    setEditingEntry(null);
                    onRefresh();
                } catch (err) {
                    onError('Failed to update entry');
                }
            };

            if (loading) {
                return <div className="card loading">📚 Loading your entries...</div>;
            }

            return (
                <div className="card">
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '30px' }}>
                        <h2>📖 My Journal Entries</h2>
                        <button className="btn btn-secondary" onClick={onRefresh}>
                            🔄 Refresh
                        </button>
                    </div>

                    {entries.length === 0 ? (
                        <div className="empty-state">
                            <h3>No entries yet</h3>
                            <p>Start your journaling journey by creating your first entry!</p>
                        </div>
                    ) : (
                        <div>
                            {entries.map(entry => (
                                <div key={entry.id} className={`journal-entry ${entry.mood}`}>
                                    {editingEntry && editingEntry.id === entry.id ? (
                                        <EditEntryForm
                                            entry={editingEntry}
                                            onChange={setEditingEntry}
                                            onSave={handleSaveEdit}
                                            onCancel={() => setEditingEntry(null)}
                                        />
                                    ) : (
                                        <>
                                            <div className="entry-header">
                                                <div>
                                                    <h3 className="entry-title">
                                                        {entry.title}
                                                        <span className={`mood-badge ${entry.mood}`}>
                                                            {entry.mood}
                                                        </span>
                                                    </h3>
                                                    <div className="entry-date">
                                                        {new Date(entry.createdAt).toLocaleDateString('en-US', {
                                                            year: 'numeric',
                                                            month: 'long',
                                                            day: 'numeric',
                                                            hour: '2-digit',
                                                            minute: '2-digit'
                                                        })}
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="entry-content">{entry.content}</div>
                                            <div className="entry-actions">
                                                <button 
                                                    className="btn btn-sm btn-secondary" 
                                                    onClick={() => handleEdit(entry)}
                                                >
                                                    ✏️ Edit
                                                </button>
                                                <button 
                                                    className="btn btn-sm btn-danger" 
                                                    onClick={() => handleDelete(entry.id)}
                                                >
                                                    🗑️ Delete
                                                </button>
                                            </div>
                                        </>
                                    )}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Edit Entry Form Component
        function EditEntryForm({ entry, onChange, onSave, onCancel }) {
            const handleChange = (field, value) => {
                onChange({ ...entry, [field]: value });
            };

            return (
                <div>
                    <div className="form-group">
                        <input
                            type="text"
                            className="form-control"
                            value={entry.title}
                            onChange={(e) => handleChange('title', e.target.value)}
                            placeholder="Title"
                        />
                    </div>
                    <div className="form-group">
                        <div className="mood-selector">
                            {MOOD_OPTIONS.map(mood => (
                                <div
                                    key={mood}
                                    className={`mood-option ${entry.mood === mood ? 'selected' : ''}`}
                                    onClick={() => handleChange('mood', mood)}
                                >
                                    {mood}
                                </div>
                            ))}
                        </div>
                    </div>
                    <div className="entry-actions">
                        <button className="btn btn-sm" onClick={onSave}>
                            💾 Save
                        </button>
                        <button className="btn btn-sm btn-secondary" onClick={onCancel}>
                            ❌ Cancel
                        </button>
                    </div>
                </div>
            );
        }

        // Community Entries Component
        function CommunityEntries({ entries, loading, onMoodFilter }) {
            const [selectedMoodFilter, setSelectedMoodFilter] = useState('');

            useEffect(() => {
                onMoodFilter('');
            }, []);

            const handleMoodFilter = (mood) => {
                setSelectedMoodFilter(mood);
                onMoodFilter(mood);
            };

            if (loading) {
                return <div className="card loading">🌍 Loading community entries...</div>;
            }

            return (
                <div className="card">
                    <h2>🌍 Community Entries</h2>
                    <p>Anonymous entries shared by the community</p>

                    <div className="filter-controls">
                        <label>Filter by mood:</label>
                        <button
                            className={`mood-option ${selectedMoodFilter === '' ? 'selected' : ''}`}
                            onClick={() => handleMoodFilter('')}
                        >
                            All
                        </button>
                        {MOOD_OPTIONS.map(mood => (
                            <button
                                key={mood}
                                className={`mood-option ${selectedMoodFilter === mood ? 'selected' : ''}`}
                                onClick={() => handleMoodFilter(mood)}
                            >
                                {mood}
                            </button>
                        ))}
                    </div>

                    {entries.length === 0 ? (
                        <div className="empty-state">
                            <h3>No community entries found</h3>
                            <p>Be the first to share your thoughts with the community!</p>
                        </div>
                    ) : (
                        <div>
                            {entries.map(entry => (
                                <div key={entry.id} className={`journal-entry ${entry.mood}`}>
                                    <div className="entry-header">
                                        <h3 className="entry-title">
                                            {entry.title}
                                            <span className={`mood-badge ${entry.mood}`}>
                                                {entry.mood}
                                            </span>
                                        </h3>
                                        <div className="entry-date">
                                            {new Date(entry.createdAt).toLocaleDateString('en-US', {
                                                year: 'numeric',
                                                month: 'long',
                                                day: 'numeric'
                                            })}
                                        </div>
                                    </div>
                                    <div className="entry-content">{entry.content}</div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Dashboard Component
        function Dashboard({ entries, loading }) {
            const chartRefs = {
                pie: useRef(null),
                line: useRef(null)
            };
            const [charts, setCharts] = useState({});

            const getMoodStats = () => {
                const moodCounts = MOOD_OPTIONS.reduce((acc, mood) => {
                    acc[mood] = entries.filter(entry => entry.mood === mood).length;
                    return acc;
                }, {});

                const total = entries.length;
                const mostCommonMood = Object.entries(moodCounts).reduce((a, b) => 
                    moodCounts[a[0]] > moodCounts[b[0]] ? a : b, ['NEUTRAL', 0]
                );

                // Calculate streak and other stats
                const sortedEntries = entries.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                const uniqueDays = new Set(sortedEntries.map(entry => 
                    new Date(entry.createdAt).toDateString()
                )).size;

                return {
                    total,
                    moodCounts,
                    mostCommonMood: mostCommonMood[0],
                    uniqueDays,
                    recentMood: sortedEntries[0]?.mood || 'NEUTRAL'
                };
            };

            const getWeeklyTrend = () => {
                const last7Days = [];
                const today = new Date();
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toDateString();
                    
                    const dayEntries = entries.filter(entry => 
                        new Date(entry.createdAt).toDateString() === dateStr
                    );
                    
                    last7Days.push({
                        date: date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }),
                        count: dayEntries.length,
                        moods: dayEntries.map(e => e.mood)
                    });
                }
                
                return last7Days;
            };

            useEffect(() => {
                if (entries.length === 0) return;

                // Destroy existing charts
                Object.values(charts).forEach(chart => {
                    if (chart) chart.destroy();
                });

                const stats = getMoodStats();
                const weeklyTrend = getWeeklyTrend();

                // Mood Distribution Pie Chart
                if (chartRefs.pie.current) {
                    const ctx = chartRefs.pie.current.getContext('2d');
                    const pieChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: MOOD_OPTIONS,
                            datasets: [{
                                data: MOOD_OPTIONS.map(mood => stats.moodCounts[mood]),
                                backgroundColor: [
                                    '#28a745', '#6c757d', '#ffc107', '#dc3545',
                                    '#17a2b8', '#20c997', '#6f42c1'
                                ],
                                borderWidth: 0,
                                hoverBorderWidth: 3,
                                hoverBorderColor: '#fff'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        padding: 20,
                                        usePointStyle: true,
                                        font: {
                                            size: 12
                                        }
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = ((context.parsed / total) * 100).toFixed(1);
                                            return `${context.label}: ${context.parsed} (${percentage}%)`;
                                        }
                                    }
                                }
                            },
                            cutout: '60%'
                        }
                    });

                    // Weekly Trend Line Chart
                    if (chartRefs.line.current) {
                        const lineCtx = chartRefs.line.current.getContext('2d');
                        const lineChart = new Chart(lineCtx, {
                            type: 'line',
                            data: {
                                labels: weeklyTrend.map(day => day.date),
                                datasets: [{
                                    label: 'Daily Entries',
                                    data: weeklyTrend.map(day => day.count),
                                    borderColor: '#667eea',
                                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                    tension: 0.4,
                                    fill: true,
                                    pointBackgroundColor: '#667eea',
                                    pointBorderColor: '#fff',
                                    pointBorderWidth: 2,
                                    pointRadius: 6
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            stepSize: 1
                                        },
                                        grid: {
                                            color: 'rgba(0,0,0,0.1)'
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                }
                            }
                        });

                        setCharts({ pie: pieChart, line: lineChart });
                    } else {
                        setCharts({ pie: pieChart });
                    }
                }
            }, [entries]);

            if (loading) {
                return <div className="card loading">📊 Loading your dashboard...</div>;
            }

            if (entries.length === 0) {
                return (
                    <div className="card">
                        <div className="empty-state">
                            <h3>📊 Your Dashboard</h3>
                            <p>Start journaling to see your mood trends and insights!</p>
                        </div>
                    </div>
                );
            }

            const stats = getMoodStats();

            return (
                <div>
                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-number">{stats.total}</div>
                            <div className="stat-label">Total Entries</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">{stats.uniqueDays}</div>
                            <div className="stat-label">Days Journaled</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">{stats.mostCommonMood}</div>
                            <div className="stat-label">Most Common Mood</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">{stats.recentMood}</div>
                            <div className="stat-label">Recent Mood</div>
                        </div>
                    </div>

                    <div className="charts-grid">
                        <div className="chart-container">
                            <div className="chart-title">Mood Distribution</div>
                            <div style={{ height: '300px', position: 'relative' }}>
                                <canvas ref={chartRefs.pie}></canvas>
                            </div>
                        </div>
                        <div className="chart-container">
                            <div className="chart-title">7-Day Trend</div>
                            <div style={{ height: '300px', position: 'relative' }}>
                                <canvas ref={chartRefs.line}></canvas>
                            </div>
                        </div>
                    </div>

                    <div className="card">
                        <h3>🔮 Mood Insights</h3>
                        <div style={{ lineHeight: '1.8' }}>
                            {stats.total > 0 && (
                                <div>
                                    <p><strong>Great job keeping up with journaling! 🎉</strong></p>
                                    <p>You've journaled for <strong>{stats.uniqueDays}</strong> different days with a total of <strong>{stats.total}</strong> entries.</p>
                                    
                                    {stats.mostCommonMood === 'HAPPY' && (
                                        <p>💚 Your most frequent mood is <strong>HAPPY</strong> - you're radiating positive energy!</p>
                                    )}
                                    {stats.mostCommonMood === 'SAD' && (
                                        <p>💙 You've been feeling <strong>SAD</strong> lately. Remember, it's okay to feel this way. Consider reaching out to someone you trust.</p>
                                    )}
                                    {stats.mostCommonMood === 'ANXIOUS' && (
                                        <p>💛 <strong>ANXIOUS</strong> feelings seem common for you. Try some deep breathing exercises or mindfulness practices.</p>
                                    )}
                                    {stats.mostCommonMood === 'ANGRY' && (
                                        <p>❤️ You've been experiencing <strong>ANGER</strong> frequently. Physical exercise or creative outlets might help channel these feelings.</p>
                                    )}
                                    {stats.mostCommonMood === 'CHILL' && (
                                        <p>🌊 You're mostly <strong>CHILL</strong> - that's a great balanced state to maintain!</p>
                                    )}
                                    {stats.mostCommonMood === 'CALM' && (
                                        <p>🕊️ <strong>CALM</strong> is your dominant mood - you seem to have found your inner peace!</p>
                                    )}
                                    {stats.mostCommonMood === 'NEUTRAL' && (
                                        <p>⚪ You're mostly <strong>NEUTRAL</strong> - steady and balanced, which can be a sign of emotional stability.</p>
                                    )}
                                    
                                    <p><em>Keep journaling to track your emotional journey and identify patterns that help you understand yourself better.</em></p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Render the main app
        ReactDOM.render(<MoodJournalApp />, document.getElementById('root'));
    </script>
</body>
</html>